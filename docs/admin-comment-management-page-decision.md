# 评论管理页面决策文档

**创建日期：** 2025-01-XX  
**状态：** ✅ 已决策

---

## 📋 问题

用户提出两个问题：
1. 仪表盘显示了管理员自己的评论，这不合理
2. 仪表盘已经显示未读评论列表，是否还需要保留"评论管理"选项

---

## ✅ 解决方案

### 1. 排除管理员自己的评论

**问题：** 管理员在仪表盘看到自己发布的评论，这不合理。

**解决方案：**
- 在 `GET /api/admin/comments/unread` API 中添加过滤条件
- 在 `GET /api/admin/comments/unread-count` API 中添加过滤条件
- 使用 Prisma 的 `not` 操作符排除 `userId = admin.id` 的评论

**实现：**
```typescript
where: {
  isRead: false,
  userId: {
    not: user.id, // Exclude admin's own comments
  },
}
```

**影响：**
- ✅ 管理员不再看到自己的评论
- ✅ 未读评论数量更准确
- ✅ 只显示需要管理员关注的评论（来自其他用户）

---

### 2. 评论管理页面保留决策

**当前状态：**
- 仪表盘显示未读评论列表
- 评论管理页面 (`/admin/comments`) 也只显示未读评论列表
- 两者功能重复

**决策：** 暂时移除导航链接，但保留页面和路由

**理由：**

1. **当前功能重复**
   - 仪表盘和评论管理页面显示相同内容
   - 保留导航链接会造成混淆

2. **未来扩展需求**
   根据讨论文档 (`docs/admin-comment-notification-discussion.md`)，评论管理页面未来可能需要：
   - 查看所有评论（包括已读的）
   - 搜索和筛选功能
   - 批量操作（批量标记已读、批量删除）
   - 按文章分组显示
   - 评论回复功能（在管理后台直接回复）
   - 评论审核功能

3. **保留页面和路由**
   - 页面代码保留，便于未来扩展
   - 路由保留，避免未来重新创建
   - 可以通过直接访问 URL 访问（如果需要）

**实施：**
- ✅ 从导航栏移除"评论管理"链接
- ✅ 保留 `/admin/comments` 页面和路由
- ✅ 添加注释说明保留原因

**未来扩展建议：**
当需要以下功能时，可以重新启用评论管理页面：
1. 查看所有评论（已读+未读）
2. 搜索评论（按内容、作者、文章）
3. 筛选评论（按文章、日期、状态）
4. 批量操作（批量标记已读、批量删除）
5. 评论统计（评论数量趋势、热门文章等）

---

## 📊 修改总结

### 修改的文件

1. **`app/api/admin/comments/unread/route.ts`**
   - 添加 `userId: { not: user.id }` 过滤条件

2. **`app/api/admin/comments/unread-count/route.ts`**
   - 添加 `userId: { not: user.id }` 过滤条件

3. **`components/admin/AdminNavigation.tsx`**
   - 从导航项中移除"评论管理"
   - 添加注释说明保留原因

### 保留的文件

- `app/admin/comments/page.tsx` - 保留页面，便于未来扩展
- `components/admin/UnreadCommentsList.tsx` - 保留组件，仪表盘和评论管理页面共用

---

## ✅ 验收标准

- [x] 管理员不再看到自己的评论
- [x] 未读评论数量准确（排除管理员自己的评论）
- [x] 导航栏不再显示"评论管理"链接
- [x] 评论管理页面仍然可以通过直接 URL 访问
- [x] 代码注释说明保留原因

---

**决策状态：** ✅ 已实施

