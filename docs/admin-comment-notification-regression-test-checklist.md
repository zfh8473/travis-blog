# 管理员评论通知功能 - 回归测试清单

**创建日期：** 2025-01-XX  
**状态：** 📋 待执行

---

## 📋 测试前准备

- [ ] 备份数据库
- [ ] 确认测试环境配置正确
- [ ] 准备测试数据（文章、评论、用户）
- [ ] 确认所有依赖已安装

---

## 1. 评论核心功能回归测试

### 1.1 评论创建

- [ ] **匿名用户创建评论**
  - 访问文章详情页
  - 填写姓名和评论内容
  - 提交评论
  - 验证评论成功创建
  - 验证评论显示在列表中
  - 验证评论 isRead = false（数据库检查）

- [ ] **登录用户创建评论**
  - 登录用户账户
  - 访问文章详情页
  - 填写评论内容（无需姓名）
  - 提交评论
  - 验证评论成功创建
  - 验证评论显示用户名
  - 验证评论 isRead = false（数据库检查）

- [ ] **评论内容验证**
  - 测试空内容（应失败）
  - 测试超长内容（应截断或失败）
  - 测试特殊字符（HTML、脚本等）
  - 验证内容正确转义

### 1.2 评论回复

- [ ] **回复评论**
  - 点击"回复"按钮
  - 填写回复内容
  - 提交回复
  - 验证回复嵌套显示正确
  - 验证回复作者信息正确
  - 验证回复 isRead = false（数据库检查）

- [ ] **嵌套回复**
  - 创建多级嵌套回复
  - 验证嵌套结构正确
  - 验证显示层级正确

### 1.3 评论删除

- [ ] **管理员删除评论**
  - 管理员登录
  - 访问文章详情页
  - 删除评论
  - 验证评论从列表移除
  - 验证删除确认对话框显示

- [ ] **评论作者删除自己的评论**
  - 登录用户创建评论
  - 删除自己的评论
  - 验证评论从列表移除

- [ ] **删除有回复的评论**
  - 创建评论和回复
  - 删除父评论
  - 验证回复也被删除（级联删除）

### 1.4 评论显示

- [ ] **评论列表显示**
  - 访问有评论的文章
  - 验证评论列表正确显示
  - 验证评论排序（时间倒序）
  - 验证评论内容正确显示

- [ ] **评论作者信息**
  - 验证登录用户显示用户名和头像
  - 验证匿名用户显示"访客：姓名"
  - 验证作者名称正确显示

- [ ] **评论时间显示**
  - 验证相对时间显示（如 "2 小时前"）
  - 验证时间工具提示显示完整日期
  - 验证时间格式正确

---

## 2. 文章功能回归测试

### 2.1 文章创建

- [ ] **创建新文章**
  - 管理员登录
  - 访问文章创建页面
  - 填写文章信息
  - 保存为草稿
  - 验证文章保存成功

- [ ] **发布文章**
  - 编辑草稿文章
  - 选择分类和标签
  - 发布文章
  - 验证文章在首页显示
  - 验证文章详情页可访问

### 2.2 文章编辑

- [ ] **编辑文章**
  - 访问文章编辑页面
  - 修改文章内容
  - 保存修改
  - 验证修改正确保存

- [ ] **文章分类和标签**
  - 编辑文章分类
  - 添加/删除标签
  - 验证分类和标签正确保存

### 2.3 文章显示

- [ ] **文章详情页**
  - 访问文章详情页
  - 验证文章内容正确显示
  - 验证文章元数据正确（作者、时间、分类、标签）
  - 验证评论区域显示

- [ ] **文章列表**
  - 访问首页
  - 验证文章列表正确显示
  - 验证文章排序功能
  - 验证分页功能（如果有）

---

## 3. 用户认证回归测试

### 3.1 登录/登出

- [ ] **用户登录**
  - 访问登录页面
  - 输入正确的邮箱和密码
  - 提交登录
  - 验证登录成功
  - 验证用户信息正确显示

- [ ] **用户登出**
  - 登录用户
  - 点击登出按钮
  - 验证登出成功
  - 验证重定向到首页

- [ ] **登录失败**
  - 输入错误的邮箱或密码
  - 验证错误提示显示
  - 验证未登录成功

### 3.2 权限控制

- [ ] **管理员权限**
  - 管理员登录
  - 访问管理后台
  - 验证可访问所有管理功能
  - 验证未读评论功能可访问

- [ ] **普通用户权限**
  - 普通用户登录
  - 尝试访问管理后台
  - 验证重定向或拒绝访问
  - 验证可正常创建评论

- [ ] **未登录用户权限**
  - 未登录状态
  - 验证可访问公开页面
  - 验证可创建匿名评论
  - 验证无法访问管理后台

---

## 4. 新功能测试

### 4.1 未读评论数量

- [ ] **获取未读评论数量**
  - 管理员登录
  - 访问管理后台
  - 验证未读评论数量正确显示
  - 创建新评论
  - 验证数量自动更新

### 4.2 未读评论列表

- [ ] **显示未读评论列表**
  - 管理员登录
  - 访问管理后台或评论管理页面
  - 验证未读评论列表正确显示
  - 验证评论信息完整（内容、作者、时间、文章）

### 4.3 标记评论为已读

- [ ] **点击未读评论**
  - 管理员登录
  - 访问评论管理页面
  - 点击未读评论
  - 验证跳转到文章页面
  - 验证自动滚动到评论位置
  - 验证评论高亮显示
  - 验证评论在数据库中标记为已读

- [ ] **返回评论管理页面**
  - 从文章页面返回评论管理页面
  - 验证已读评论从列表中移除
  - 验证未读评论数量更新

### 4.4 评论锚点跳转

- [ ] **直接访问评论锚点**
  - 访问 `/articles/[slug]#comment-[id]`
  - 验证页面正确加载
  - 验证自动滚动到评论位置
  - 验证评论高亮显示

---

## 5. 数据库验证

### 5.1 数据完整性

- [ ] **新评论 isRead 字段**
  - 创建新评论
  - 检查数据库
  - 验证 isRead = false
  - 验证 readAt = null
  - 验证 readBy = null

- [ ] **标记已读后数据**
  - 标记评论为已读
  - 检查数据库
  - 验证 isRead = true
  - 验证 readAt 不为 null
  - 验证 readBy 为管理员 ID

- [ ] **索引验证**
  - 验证索引已创建
  - 验证查询性能

### 5.2 数据一致性

- [ ] **评论删除后数据**
  - 删除评论
  - 验证评论从数据库删除
  - 验证级联删除正确（如果有）

---

## 6. UI/UX 测试

### 6.1 响应式设计

- [ ] **移动端显示**
  - 在移动设备上测试
  - 验证未读评论列表显示正确
  - 验证按钮和链接可点击
  - 验证触摸目标大小合适

- [ ] **桌面端显示**
  - 在桌面浏览器上测试
  - 验证布局正确
  - 验证交互正常

### 6.2 用户体验

- [ ] **加载状态**
  - 验证加载中状态显示
  - 验证加载完成状态

- [ ] **错误处理**
  - 验证错误消息显示
  - 验证重试功能

- [ ] **动画效果**
  - 验证评论高亮动画
  - 验证滚动动画

---

## 7. 性能测试

- [ ] **API 响应时间**
  - 测试未读评论数量 API（< 100ms）
  - 测试未读评论列表 API（< 200ms）
  - 测试标记已读 API（< 50ms）

- [ ] **页面加载时间**
  - 测试管理后台页面加载（< 1s）
  - 测试评论管理页面加载（< 1s）

- [ ] **大量数据测试**
  - 创建 100+ 未读评论
  - 验证列表渲染性能
  - 验证分页功能（如果有）

---

## 8. 安全测试

- [ ] **权限验证**
  - 未登录用户访问 API（应返回 401）
  - 普通用户访问 API（应返回 403）
  - 管理员访问 API（应返回 200）

- [ ] **SQL 注入防护**
  - 测试特殊字符输入
  - 验证数据正确转义

- [ ] **XSS 防护**
  - 测试脚本标签输入
  - 验证内容正确转义

---

## 📊 测试结果

**测试日期：** ___________  
**测试人员：** ___________  
**测试环境：** ___________  

**通过项：** ___ / ___  
**失败项：** ___ / ___  
**阻塞项：** ___ / ___  

---

## 🐛 发现的问题

（记录测试过程中发现的问题）

---

## ✅ 测试通过标准

- [ ] 所有回归测试用例通过
- [ ] 所有新功能测试用例通过
- [ ] 无严重 bug（P0/P1）
- [ ] 性能指标满足要求
- [ ] 安全测试通过

---

**测试状态：** 📋 待执行

