# 管理员评论通知功能 - 测试计划

**创建日期：** 2025-01-XX  
**状态：** 🧪 测试中

---

## 📋 测试范围

### 1. 功能测试

#### 1.1 API 端点测试

**GET /api/admin/comments/unread-count**
- [ ] 返回正确的未读评论数量
- [ ] 无未读评论时返回 0
- [ ] 需要管理员权限
- [ ] 未登录用户返回 401
- [ ] 非管理员用户返回 403

**GET /api/admin/comments/unread**
- [ ] 返回未读评论列表
- [ ] 包含文章信息（id, title, slug）
- [ ] 包含用户信息（如果有）
- [ ] 按创建时间倒序排列
- [ ] 支持 limit 参数（默认 20，最大 100）
- [ ] 无未读评论时返回空数组
- [ ] 需要管理员权限

**PUT /api/admin/comments/[id]/read**
- [ ] 成功标记评论为已读
- [ ] 设置 readAt 时间戳
- [ ] 设置 readBy 为当前管理员 ID
- [ ] 已读评论不会重复更新
- [ ] 不存在的评论返回 404
- [ ] 无效的评论 ID 返回 400
- [ ] 需要管理员权限

**POST /api/comments（修改后）**
- [ ] 新创建的评论 isRead = false
- [ ] 匿名评论 isRead = false
- [ ] 登录用户评论 isRead = false

#### 1.2 前端组件测试

**UnreadCommentsBadge 组件**
- [ ] 显示未读评论数量
- [ ] 无未读评论时不显示徽章
- [ ] 数量超过 99 显示 "99+"
- [ ] 点击跳转到评论管理页面
- [ ] 自动刷新未读数量

**UnreadCommentsList 组件**
- [ ] 显示未读评论列表
- [ ] 显示评论内容（截断长文本）
- [ ] 显示作者名称（用户或访客）
- [ ] 显示相对时间（如 "2 小时前"）
- [ ] 显示文章标题链接
- [ ] 点击评论跳转到文章页面
- [ ] 点击后自动标记为已读
- [ ] 从文章页面返回后自动刷新列表
- [ ] 无未读评论时显示提示信息
- [ ] 加载状态显示
- [ ] 错误状态显示和重试

**CommentScrollHandler 组件**
- [ ] 支持 #comment-[id] 锚点
- [ ] 自动滚动到指定评论
- [ ] 评论高亮显示（2 秒后消失）
- [ ] 评论加载完成后才滚动

#### 1.3 管理后台集成测试

**管理后台仪表板 (/admin)**
- [ ] 显示未读评论列表
- [ ] 显示未读评论徽章
- [ ] 点击徽章跳转到评论管理页面

**评论管理页面 (/admin/comments)**
- [ ] 页面可访问（需要管理员权限）
- [ ] 显示未读评论列表
- [ ] 非管理员用户重定向

**导航栏**
- [ ] 显示"评论管理"链接
- [ ] 链接高亮显示（当前页面）

---

### 2. 回归测试

#### 2.1 评论核心功能

**评论创建**
- [ ] 匿名用户可创建评论
- [ ] 登录用户可创建评论
- [ ] 评论内容正确保存
- [ ] 评论显示在文章页面
- [ ] 评论时间正确显示

**评论回复**
- [ ] 可回复评论
- [ ] 回复嵌套显示正确
- [ ] 回复作者信息正确

**评论删除**
- [ ] 管理员可删除评论
- [ ] 评论作者可删除自己的评论
- [ ] 删除后评论从列表移除

**评论显示**
- [ ] 评论列表正确显示
- [ ] 评论排序正确（时间倒序）
- [ ] 评论分页正确（如果有）

#### 2.2 文章功能

**文章创建**
- [ ] 可创建新文章
- [ ] 文章内容正确保存
- [ ] 文章分类和标签正确

**文章编辑**
- [ ] 可编辑文章
- [ ] 修改内容正确保存

**文章显示**
- [ ] 文章详情页正确显示
- [ ] 文章列表正确显示

#### 2.3 用户认证

**登录/登出**
- [ ] 用户可正常登录
- [ ] 用户可正常登出
- [ ] 会话管理正常

**权限控制**
- [ ] 管理员权限正确
- [ ] 普通用户权限正确
- [ ] 未登录用户权限正确

---

### 3. 性能测试

- [ ] 未读评论数量查询性能（< 100ms）
- [ ] 未读评论列表查询性能（< 200ms）
- [ ] 标记评论为已读性能（< 50ms）
- [ ] 大量未读评论时的列表渲染性能

---

### 4. 安全测试

- [ ] SQL 注入防护
- [ ] XSS 攻击防护
- [ ] CSRF 防护
- [ ] 权限验证正确
- [ ] 敏感信息不泄露

---

## 🧪 测试执行

### 手动测试步骤

1. **准备测试数据**
   - 创建测试文章
   - 创建测试评论（匿名和登录用户）
   - 创建测试管理员账户

2. **API 测试**
   - 使用 Postman 或 curl 测试所有 API 端点
   - 验证请求/响应格式
   - 验证错误处理

3. **前端测试**
   - 在浏览器中测试所有功能
   - 验证 UI/UX
   - 验证响应式设计

4. **回归测试**
   - 测试现有功能不受影响
   - 验证数据完整性

### 自动化测试

运行集成测试：
```bash
npm test -- admin-comments-api
```

---

## 📊 测试结果

测试完成后，请填写以下信息：

- [ ] 所有功能测试通过
- [ ] 所有回归测试通过
- [ ] 性能测试通过
- [ ] 安全测试通过
- [ ] 无已知 bug

**测试日期：** ___________  
**测试人员：** ___________  
**测试环境：** ___________  

---

## 🐛 已知问题

（记录测试过程中发现的问题）

---

## ✅ 测试通过标准

- 所有功能测试用例通过
- 所有回归测试用例通过
- 无严重 bug（P0/P1）
- 性能指标满足要求
- 安全测试通过

---

**测试状态：** 🧪 进行中

