# Epic 5 留言板功能 - 快速测试指南

**测试日期：** 2025-11-17  
**状态：** 🧪 准备测试

---

## 🚀 快速开始

### 1. 启动开发服务器

```bash
# 如果服务器未运行，启动它
npm run dev
```

**等待服务器启动完成**（看到 "Ready" 消息）

---

## ✅ 阶段 1: 本地功能测试（5-10分钟）

### 测试 1: 留言创建（登录用户）

1. 打开浏览器访问：http://localhost:3000
2. 登录账号（如果未登录）
3. 点击任意一篇文章进入详情页
4. 滚动到底部，找到"留言"区域
5. 在留言表单输入："这是一条测试留言"
6. 点击"提交留言"
7. ✅ **验证：** 留言立即出现在列表中，显示用户名

**预期结果：** ✅ 留言成功创建并显示

---

### 测试 2: 留言创建（匿名用户）

1. 点击右上角"登出"
2. 刷新页面，进入任意文章详情页
3. 在留言表单输入：
   - 姓名："测试访客"
   - 留言："这是匿名用户的留言"
4. 点击"提交留言"
5. ✅ **验证：** 留言显示"访客：测试访客"

**预期结果：** ✅ 匿名留言成功创建

---

### 测试 3: 留言回复

1. 在任意留言下方点击"回复"按钮
2. ✅ **验证：** 回复表单出现（带缩进和边框）
3. 输入回复内容："这是回复"
4. 点击"提交回复"
5. ✅ **验证：** 回复显示在父留言下方（带缩进）

**预期结果：** ✅ 回复成功创建并嵌套显示

---

### 测试 4: 嵌套回复（3层深度）

1. 创建一条顶级留言
2. 回复它（深度 1）
3. 回复回复（深度 2）
4. 回复回复的回复（深度 3）
5. 尝试回复深度 3 的回复（深度 4）
6. ✅ **验证：** 显示错误"已达到最大回复深度（3 层）"

**预期结果：** ✅ 最多 3 层深度，超过被拒绝

---

### 测试 5: 留言删除（管理员）

1. 使用管理员账号登录
2. 访问包含留言的文章
3. ✅ **验证：** 留言显示"删除"按钮
4. 点击"删除"按钮
5. 确认删除
6. ✅ **验证：** 留言立即消失

**预期结果：** ✅ 管理员可以删除留言

---

### 测试 6: 浏览器控制台检查

1. 打开开发者工具（F12）
2. 切换到"Console"标签
3. 执行上述所有测试
4. ✅ **验证：** 无 React 错误 #418
5. ✅ **验证：** 无 500 错误
6. 切换到"Network"标签
7. ✅ **验证：** /api/comments 请求返回 200

**预期结果：** ✅ 无错误

---

## 🚀 阶段 2: 部署到 Vercel（自动）

### 步骤 1: 提交代码

```bash
# 添加所有文件
git add .

# 提交
git commit -m "feat: 实现简化架构的留言板功能

- 创建 API Routes (/api/comments)
- 重构组件为纯 Client Components
- 使用 getUserFromRequestOrHeaders 避免 Vercel 卡住问题
- 修复 Date 序列化问题
- 完整的错误处理和类型安全"

# 推送到 GitHub
git push origin epic5-simplified-architecture
```

### 步骤 2: 等待 Vercel 部署

1. 访问 Vercel Dashboard
2. 查看部署状态
3. 等待部署完成（通常 2-5 分钟）
4. 复制预览环境 URL

### 步骤 3: Vercel 环境测试

1. 访问预览 URL
2. ✅ **验证：** 页面正常加载（不卡住）
3. 重复阶段 1 的所有测试
4. ✅ **验证：** 无 React 错误
5. ✅ **验证：** 无 500 错误

---

## 🚀 阶段 3: 回归测试（5分钟）

### 快速检查清单

- [ ] 文章列表正常显示
- [ ] 文章详情页正常显示
- [ ] 登录功能正常
- [ ] 注册功能正常
- [ ] 分类导航正常
- [ ] 标签功能正常
- [ ] 搜索功能正常

**预期结果：** ✅ 所有已测试功能正常工作

---

## 📊 测试结果记录

### 本地测试

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 留言创建（登录） | ⏳ | |
| 留言创建（匿名） | ⏳ | |
| 留言回复 | ⏳ | |
| 嵌套回复 | ⏳ | |
| 留言删除 | ⏳ | |
| 控制台检查 | ⏳ | |

### Vercel 测试

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 页面加载 | ⏳ | |
| 功能测试 | ⏳ | |
| 错误检查 | ⏳ | |

### 回归测试

| Epic | 状态 | 备注 |
|------|------|------|
| Epic 1-4, 6 | ⏳ | |

---

## 🐛 问题记录

### 发现的问题

1. **问题：** (填写)
   - **严重程度：** 高/中/低
   - **状态：** 待修复

---

## ✅ 测试结论

- [ ] ✅ 所有测试通过
- [ ] ⚠️ 部分测试失败
- [ ] ❌ 测试失败

---

**最后更新：** 2025-11-17

