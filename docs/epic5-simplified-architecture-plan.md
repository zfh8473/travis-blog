# Epic 5 ç•™è¨€æ¿åŠŸèƒ½ - ç®€åŒ–æ¶æ„å®æ–½è®¡åˆ’

**åˆ›å»ºæ—¥æœŸï¼š** 2025-11-17  
**è´Ÿè´£äººï¼š** Winston (Architect) + Amelia (DEV)  
**çŠ¶æ€ï¼š** ğŸ“‹ è®¾è®¡é˜¶æ®µ  
**åŸºå‡†ç‰ˆæœ¬ï¼š** 446c988

---

## ğŸ¯ ç›®æ ‡

é‡‡ç”¨ç®€åŒ–æ¶æ„é‡æ–°å®ç°ç•™è¨€æ¿åŠŸèƒ½ï¼Œé¿å…ä¹‹å‰é‡åˆ°çš„ Server Components/Client Components æ··åˆä½¿ç”¨é—®é¢˜ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

1. **çº¯ API Routes** - ä¸ä½¿ç”¨ Server Actions
2. **çº¯ Client Components** - æ‰€æœ‰ç•™è¨€ç›¸å…³ç»„ä»¶éƒ½æ˜¯ Client Components
3. **ç®€åŒ–ä¼šè¯ç®¡ç†** - ä½¿ç”¨å®¢æˆ·ç«¯ `useSession` hook
4. **æ ‡å‡† JSON åºåˆ—åŒ–** - é¿å… Date å¯¹è±¡åºåˆ—åŒ–é—®é¢˜

### æ¶æ„å›¾

```
Article Detail Page (Server Component)
    â”‚
    â”œâ”€ Article Content
    â”‚
    â””â”€ CommentsSection (Client Component)
         â”‚
         â”œâ”€ useSession() - è·å–ä¼šè¯
         â”œâ”€ fetch('/api/comments') - è·å–ç•™è¨€åˆ—è¡¨
         â”‚
         â”œâ”€ CommentForm (Client Component)
         â”‚    â””â”€ POST /api/comments
         â”‚
         â””â”€ CommentList (Client Component)
              â””â”€ CommentItem (Client Component)
                   â””â”€ DELETE /api/comments/[id]
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: ä»£ç å›é€€ï¼ˆ15 åˆ†é’Ÿï¼‰

- [ ] å›é€€åˆ°ç‰ˆæœ¬ 446c988
- [ ] ç¡®è®¤ç•™è¨€æ¿åŠŸèƒ½å·²è¢«æ³¨é‡Š
- [ ] å¤‡ä»½å½“å‰ä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰

### é˜¶æ®µ 2: åˆ›å»º API Routesï¼ˆ1-2 å°æ—¶ï¼‰

#### 2.1 åˆ›å»º `/api/comments/route.ts`

**åŠŸèƒ½ï¼š**
- `GET` - è·å–æ–‡ç« çš„æ‰€æœ‰ç•™è¨€ï¼ˆåŒ…æ‹¬åµŒå¥—å›å¤ï¼‰
- `POST` - åˆ›å»ºæ–°ç•™è¨€æˆ–å›å¤

**å®ç°è¦ç‚¹ï¼š**
- ä½¿ç”¨æ ‡å‡†çš„ Next.js API Route
- ä½¿ç”¨ `getServerSession` è·å–ä¼šè¯ï¼ˆä»…åœ¨éœ€è¦æ—¶ï¼‰
- è¿”å›æ ‡å‡† JSON å“åº”
- Date å¯¹è±¡è½¬æ¢ä¸º ISO å­—ç¬¦ä¸²

#### 2.2 åˆ›å»º `/api/comments/[id]/route.ts`

**åŠŸèƒ½ï¼š**
- `DELETE` - åˆ é™¤ç•™è¨€ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

**å®ç°è¦ç‚¹ï¼š**
- éªŒè¯ç®¡ç†å‘˜æƒé™
- çº§è”åˆ é™¤å›å¤

### é˜¶æ®µ 3: é‡æ„ç»„ä»¶ï¼ˆ2-3 å°æ—¶ï¼‰

#### 3.1 CommentsSection (Client Component)

**èŒè´£ï¼š**
- è·å–ä¼šè¯ï¼ˆä½¿ç”¨ `useSession`ï¼‰
- è·å–ç•™è¨€åˆ—è¡¨ï¼ˆä½¿ç”¨ `fetch`ï¼‰
- ç®¡ç†ç•™è¨€åˆ—è¡¨çŠ¶æ€
- å¤„ç†ç•™è¨€åˆ›å»º/åˆ é™¤åçš„åˆ·æ–°

**å®ç°è¦ç‚¹ï¼š**
- çº¯ Client Component
- ä½¿ç”¨ React hooks ç®¡ç†çŠ¶æ€
- ä½¿ç”¨ `router.refresh()` æˆ–é‡æ–°è·å–æ•°æ®

#### 3.2 CommentForm (Client Component)

**èŒè´£ï¼š**
- æ˜¾ç¤ºç•™è¨€è¡¨å•
- å¤„ç†è¡¨å•æäº¤
- è°ƒç”¨ POST /api/comments

**å®ç°è¦ç‚¹ï¼š**
- ä¿æŒç°æœ‰éªŒè¯é€»è¾‘
- ä½¿ç”¨ `fetch` è°ƒç”¨ API
- æˆåŠŸåé€šçŸ¥çˆ¶ç»„ä»¶åˆ·æ–°

#### 3.3 CommentList (Client Component)

**èŒè´£ï¼š**
- æ˜¾ç¤ºç•™è¨€åˆ—è¡¨
- å¤„ç†åµŒå¥—å›å¤æ˜¾ç¤º

**å®ç°è¦ç‚¹ï¼š**
- æ¥æ”¶ç•™è¨€æ•°æ®ä½œä¸º props
- é€’å½’æ¸²æŸ“ CommentItem

#### 3.4 CommentItem (Client Component)

**èŒè´£ï¼š**
- æ˜¾ç¤ºå•ä¸ªç•™è¨€
- å¤„ç†å›å¤è¡¨å•æ˜¾ç¤º
- å¤„ç†åˆ é™¤æ“ä½œ

**å®ç°è¦ç‚¹ï¼š**
- ä¿æŒç°æœ‰ UI é€»è¾‘
- ä½¿ç”¨ `fetch` è°ƒç”¨ DELETE API

### é˜¶æ®µ 4: é›†æˆåˆ°æ–‡ç« è¯¦æƒ…é¡µï¼ˆ30 åˆ†é’Ÿï¼‰

- [ ] åœ¨ `app/articles/[slug]/page.tsx` ä¸­å–æ¶ˆæ³¨é‡Šç•™è¨€åŒºåŸŸ
- [ ] æ›¿æ¢ä¸ºæ–°çš„ `CommentsSection` ç»„ä»¶
- [ ] ç¡®ä¿ä¸å½±å“æ–‡ç« å†…å®¹æ˜¾ç¤º

### é˜¶æ®µ 5: æµ‹è¯•ï¼ˆ1-2 å°æ—¶ï¼‰

#### 5.1 æœ¬åœ°æµ‹è¯•
- [ ] ç•™è¨€åˆ›å»ºï¼ˆç™»å½•ç”¨æˆ·ï¼‰
- [ ] ç•™è¨€åˆ›å»ºï¼ˆåŒ¿åç”¨æˆ·ï¼‰
- [ ] ç•™è¨€å›å¤
- [ ] ç•™è¨€åˆ é™¤ï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] åµŒå¥—å›å¤ï¼ˆ3 å±‚æ·±åº¦ï¼‰

#### 5.2 Vercel é¢„è§ˆç¯å¢ƒæµ‹è¯•
- [ ] éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒ
- [ ] æ‰§è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
- [ ] éªŒè¯æ— é”™è¯¯

#### 5.3 å›å½’æµ‹è¯•
- [ ] éªŒè¯ Epic 1-4, 6 åŠŸèƒ½ä¸å—å½±å“
- [ ] éªŒè¯æ–‡ç« è¯¦æƒ…é¡µæ­£å¸¸æ˜¾ç¤º

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### API Routes è®¾è®¡

#### GET /api/comments?articleId=xxx

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "id": "comment-1",
      "content": "ç•™è¨€å†…å®¹",
      "articleId": "article-1",
      "userId": "user-1",
      "parentId": null,
      "authorName": null,
      "createdAt": "2025-11-17T10:00:00.000Z",
      "updatedAt": "2025-11-17T10:00:00.000Z",
      "user": {
        "id": "user-1",
        "name": "ç”¨æˆ·å",
        "image": "å¤´åƒURL"
      },
      "replies": [...]
    }
  ]
}
```

#### POST /api/comments

**è¯·æ±‚æ ¼å¼ï¼š**
```json
{
  "articleId": "article-1",
  "content": "ç•™è¨€å†…å®¹",
  "parentId": null,
  "authorName": "åŒ¿åç”¨æˆ·å§“å"
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "id": "comment-1",
    ...
  }
}
```

### ç»„ä»¶çŠ¶æ€ç®¡ç†

**CommentsSection çŠ¶æ€ï¼š**
```typescript
const [comments, setComments] = useState<Comment[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```

**æ•°æ®è·å–ï¼š**
```typescript
useEffect(() => {
  fetchComments();
}, [articleId]);

const fetchComments = async () => {
  const res = await fetch(`/api/comments?articleId=${articleId}`);
  const data = await res.json();
  if (data.success) {
    setComments(data.data);
  }
};
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

1. **ç•™è¨€åˆ›å»º**
   - âœ… ç™»å½•ç”¨æˆ·å¯ä»¥åˆ›å»ºç•™è¨€
   - âœ… åŒ¿åç”¨æˆ·å¯ä»¥åˆ›å»ºç•™è¨€
   - âœ… ç•™è¨€å†…å®¹éªŒè¯æ­£å¸¸
   - âœ… åˆ›å»ºæˆåŠŸåç•™è¨€ç«‹å³æ˜¾ç¤º

2. **ç•™è¨€å›å¤**
   - âœ… å¯ä»¥å›å¤é¡¶çº§ç•™è¨€
   - âœ… å¯ä»¥åµŒå¥—å›å¤ï¼ˆæœ€å¤š 3 å±‚ï¼‰
   - âœ… å›å¤æ˜¾ç¤ºæ­£ç¡®

3. **ç•™è¨€åˆ é™¤**
   - âœ… ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ç•™è¨€
   - âœ… åˆ é™¤åçº§è”åˆ é™¤å›å¤
   - âœ… åˆ é™¤ååˆ—è¡¨ç«‹å³æ›´æ–°

4. **Vercel ç¯å¢ƒ**
   - âœ… åœ¨ Vercel é¢„è§ˆç¯å¢ƒæ­£å¸¸å·¥ä½œ
   - âœ… æ—  React é”™è¯¯
   - âœ… æ—  500 æœåŠ¡å™¨é”™è¯¯
   - âœ… é¡µé¢ä¸å¡ä½

### éåŠŸèƒ½éªŒæ”¶

- âœ… ä¸å½±å“å·²æµ‹è¯•åŠŸèƒ½ï¼ˆEpic 1-4, 6ï¼‰
- âœ… æ€§èƒ½å¯æ¥å—ï¼ˆç•™è¨€åˆ—è¡¨åŠ è½½ < 1sï¼‰
- âœ… ä»£ç ç®€æ´æ˜“ç»´æŠ¤

---

## ğŸ“ å®æ–½è®°å½•

### å¼€å§‹æ—¶é—´
- [ ] è®°å½•å¼€å§‹æ—¶é—´

### å®Œæˆæ—¶é—´
- [ ] è®°å½•å®Œæˆæ—¶é—´

### é‡åˆ°çš„é—®é¢˜
- [ ] è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

**æœ€åæ›´æ–°ï¼š** 2025-11-17  
**çŠ¶æ€ï¼š** ğŸ“‹ ç­‰å¾…å¼€å§‹å®æ–½

