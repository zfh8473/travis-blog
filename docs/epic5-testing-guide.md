# Epic 5 留言板功能 - 测试指南

**测试日期：** 2025-11-17  
**状态：** 🧪 准备开始测试

---

## 🚀 阶段 1: 本地功能测试

### 准备工作

1. **确认开发服务器运行**
   ```bash
   # 检查服务器是否运行
   curl http://localhost:3000
   ```

2. **访问测试页面**
   - 打开浏览器访问：http://localhost:3000
   - 找到任意一篇文章，点击进入详情页
   - 滚动到页面底部，应该看到"留言"区域

---

### 测试用例 1: 留言创建（登录用户）

**步骤：**
1. ✅ 确保已登录（右上角显示用户名）
2. ✅ 在留言表单中输入内容（例如："这是一条测试留言"）
3. ✅ 点击"提交留言"按钮
4. ✅ 观察留言是否立即出现在列表中
5. ✅ 验证留言显示用户名和头像
6. ✅ 验证留言显示时间戳

**预期结果：**
- ✅ 留言成功创建并立即显示
- ✅ 表单自动清空
- ✅ 显示正确的用户信息

**测试结果：** [ ] 通过 / [ ] 失败

---

### 测试用例 2: 留言创建（匿名用户）

**步骤：**
1. ✅ 点击右上角"登出"（如果已登录）
2. ✅ 刷新页面，访问任意文章详情页
3. ✅ 验证留言表单显示"姓名"输入框
4. ✅ 输入姓名（例如："测试访客"）
5. ✅ 输入留言内容（例如："这是匿名用户的留言"）
6. ✅ 点击"提交留言"按钮
7. ✅ 验证留言显示"访客：测试访客"
8. ✅ 验证留言不显示头像

**预期结果：**
- ✅ 匿名用户留言成功创建
- ✅ 显示"访客："前缀
- ✅ 表单自动清空

**测试结果：** [ ] 通过 / [ ] 失败

---

### 测试用例 3: 留言回复

**步骤：**
1. ✅ 在任意留言下方找到"回复"按钮
2. ✅ 点击"回复"按钮
3. ✅ 验证回复表单出现（带缩进和左边框）
4. ✅ 验证显示"回复 @{用户名}"提示
5. ✅ 输入回复内容（例如："这是对留言的回复"）
6. ✅ 点击"提交回复"按钮
7. ✅ 验证回复显示在父留言下方（带缩进）
8. ✅ 验证回复表单自动关闭

**预期结果：**
- ✅ 回复成功创建
- ✅ 回复正确嵌套显示
- ✅ UI 更新正常

**测试结果：** [ ] 通过 / [ ] 失败

---

### 测试用例 4: 嵌套回复（3层深度）

**步骤：**
1. ✅ 创建一条顶级留言 A
2. ✅ 回复留言 A，创建回复 B（深度 1）
3. ✅ 回复回复 B，创建回复 C（深度 2）
4. ✅ 回复回复 C，创建回复 D（深度 3）
5. ✅ 尝试回复回复 D（深度 4）
6. ✅ 验证显示错误提示："已达到最大回复深度（3 层）"
7. ✅ 验证深度 1-3 的回复都正确显示（带正确的缩进）

**预期结果：**
- ✅ 可以创建最多 3 层深度的回复
- ✅ 超过 3 层的回复被拒绝
- ✅ 显示正确的错误提示

**测试结果：** [ ] 通过 / [ ] 失败

---

### 测试用例 5: 留言删除（管理员）

**步骤：**
1. ✅ 使用管理员账号登录
2. ✅ 访问包含留言的文章详情页
3. ✅ 验证留言显示"删除"按钮（仅管理员可见）
4. ✅ 点击"删除"按钮
5. ✅ 验证确认对话框显示
6. ✅ 确认删除
7. ✅ 验证留言立即从列表中消失
8. ✅ 如果有回复，验证回复也被删除（级联删除）

**预期结果：**
- ✅ 管理员可以删除留言
- ✅ 删除确认对话框正常显示
- ✅ 留言和回复都被删除
- ✅ 列表立即更新

**测试结果：** [ ] 通过 / [ ] 失败

---

### 测试用例 6: 浏览器控制台检查

**步骤：**
1. ✅ 打开浏览器开发者工具（F12）
2. ✅ 切换到"Console"标签
3. ✅ 执行上述所有测试用例
4. ✅ 检查是否有错误信息
5. ✅ 特别检查是否有 React 错误 #418
6. ✅ 切换到"Network"标签
7. ✅ 检查 API 请求（/api/comments）
8. ✅ 验证没有 500 错误

**预期结果：**
- ✅ 无 React 错误
- ✅ 无 JavaScript 错误
- ✅ API 请求返回 200 状态码
- ✅ 无 500 服务器错误

**测试结果：** [ ] 通过 / [ ] 失败

---

## 🚀 阶段 2: 部署到 Vercel 预览环境

### 部署步骤

1. **提交代码**
   ```bash
   git add .
   git commit -m "feat: 实现简化架构的留言板功能"
   git push origin main
   ```

2. **等待 Vercel 自动部署**
   - Vercel 会自动检测到新的 commit
   - 开始构建和部署
   - 等待部署完成（通常 2-5 分钟）

3. **获取预览 URL**
   - 在 Vercel Dashboard 查看部署状态
   - 复制预览环境 URL

4. **验证部署**
   - 访问预览 URL
   - 验证页面正常加载（不卡住）
   - 检查浏览器控制台（无错误）

---

### Vercel 环境测试

**重要检查项：**
- [ ] 页面正常加载（不卡住）
- [ ] 无 React 错误 #418
- [ ] 无 500 服务器错误
- [ ] 留言功能正常工作
- [ ] 所有本地测试用例在 Vercel 环境也通过

---

## 🚀 阶段 3: 回归测试

### 验证已测试功能不受影响

**Epic 1: 文章管理**
- [ ] 文章列表正常显示
- [ ] 文章详情页正常显示
- [ ] 文章创建/编辑功能正常

**Epic 2: 用户认证**
- [ ] 登录功能正常
- [ ] 注册功能正常
- [ ] 用户资料页面正常

**Epic 3: 分类和标签**
- [ ] 分类导航正常
- [ ] 标签功能正常

**Epic 4: 媒体管理**
- [ ] 媒体上传正常
- [ ] 媒体列表正常

**Epic 6: 其他功能**
- [ ] 搜索功能正常
- [ ] 其他已测试功能正常

---

## 📊 测试结果记录

### 本地测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 留言创建（登录用户） | ⏳ | |
| 留言创建（匿名用户） | ⏳ | |
| 留言回复 | ⏳ | |
| 嵌套回复（3层） | ⏳ | |
| 留言删除（管理员） | ⏳ | |
| 浏览器控制台检查 | ⏳ | |

### Vercel 环境测试结果

| 检查项 | 状态 | 备注 |
|--------|------|------|
| 页面加载 | ⏳ | |
| React 错误 | ⏳ | |
| 500 错误 | ⏳ | |
| 功能测试 | ⏳ | |

### 回归测试结果

| Epic | 状态 | 备注 |
|------|------|------|
| Epic 1 | ⏳ | |
| Epic 2 | ⏳ | |
| Epic 3 | ⏳ | |
| Epic 4 | ⏳ | |
| Epic 6 | ⏳ | |

---

## 🐛 发现的问题

### 问题列表

1. **问题描述：** (填写)
   - **严重程度：** 高/中/低
   - **复现步骤：** (填写)
   - **状态：** 待修复/已修复

---

## ✅ 测试结论

- [ ] ✅ 所有测试通过，可以合并到主分支
- [ ] ⚠️ 部分测试失败，需要修复
- [ ] ❌ 测试失败，需要重新审查

---

**最后更新：** 2025-11-17  
**状态：** 🧪 准备开始测试

