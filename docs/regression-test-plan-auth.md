# 认证功能回归测试计划

**日期：** 2025-01-20  
**负责人：** TEA (QA)  
**状态：** 📋 待执行

---

## 📋 测试范围

### 测试功能模块
1. 用户注册功能
2. 用户登录功能（邮箱/密码）
3. Google OAuth 登录
4. 找回密码功能
5. 密码重置功能

---

## ✅ 测试用例

### 1. 用户注册功能

#### TC-AUTH-001: 正常注册流程
**步骤：**
1. 访问 `/register` 页面
2. 输入有效的邮箱地址
3. 输入密码（至少 8 个字符，包含字母和数字）
4. 输入确认密码（与密码一致）
5. 可选：输入姓名
6. 点击"注册"按钮

**预期结果：**
- 注册成功
- 自动跳转到首页或登录页面
- 用户可以在数据库中看到新用户记录

---

#### TC-AUTH-002: 密码确认校验
**步骤：**
1. 访问 `/register` 页面
2. 输入有效的邮箱地址
3. 输入密码：`password123`
4. 输入确认密码：`password456`（不一致）
5. 点击"注册"按钮

**预期结果：**
- 显示错误提示："两次输入的密码不一致"
- 注册失败
- 页面不跳转

---

#### TC-AUTH-003: 密码强度验证
**步骤：**
1. 访问 `/register` 页面
2. 输入有效的邮箱地址
3. 输入弱密码（少于 8 个字符或只包含数字/字母）
4. 点击"注册"按钮

**预期结果：**
- 显示错误提示："密码长度至少为 8 个字符" 或 "密码必须包含至少一个字母和一个数字"
- 注册失败

---

#### TC-AUTH-004: 重复邮箱注册
**步骤：**
1. 使用已注册的邮箱地址尝试注册
2. 填写其他必填信息
3. 点击"注册"按钮

**预期结果：**
- 显示错误提示："该邮箱已被注册"
- 注册失败

---

### 2. 用户登录功能（邮箱/密码）

#### TC-AUTH-005: 正常登录流程
**步骤：**
1. 访问 `/login` 页面
2. 输入已注册的邮箱地址
3. 输入正确的密码
4. 点击"登录"按钮

**预期结果：**
- 登录成功
- 自动跳转到首页或回调 URL
- 用户会话已创建

---

#### TC-AUTH-006: 错误密码登录
**步骤：**
1. 访问 `/login` 页面
2. 输入已注册的邮箱地址
3. 输入错误的密码
4. 点击"登录"按钮

**预期结果：**
- 显示错误提示："Invalid email or password. Please try again."
- 登录失败
- 页面不跳转

---

#### TC-AUTH-007: 不存在的邮箱登录
**步骤：**
1. 访问 `/login` 页面
2. 输入不存在的邮箱地址
3. 输入任意密码
4. 点击"登录"按钮

**预期结果：**
- 显示错误提示："Invalid email or password. Please try again."
- 登录失败

---

### 3. Google OAuth 登录

#### TC-AUTH-008: Google 登录流程
**步骤：**
1. 访问 `/login` 页面
2. 点击"Sign in with Google"按钮
3. 在 Google 登录页面输入 Google 账号信息
4. 授权应用访问

**预期结果：**
- 重定向到 Google 登录页面
- 授权后自动跳转回应用
- 登录成功
- 如果用户不存在，自动创建新用户
- 如果用户已存在，链接到现有账号

---

#### TC-AUTH-009: Google 登录取消
**步骤：**
1. 访问 `/login` 页面
2. 点击"Sign in with Google"按钮
3. 在 Google 登录页面点击"取消"

**预期结果：**
- 返回登录页面
- 显示适当的错误提示（如果有）
- 未创建会话

---

### 4. 找回密码功能

#### TC-AUTH-010: 正常找回密码流程
**步骤：**
1. 访问 `/login` 页面
2. 点击"忘记密码？"链接
3. 输入已注册的邮箱地址
4. 点击"发送重置链接"按钮
5. 检查邮箱收件箱

**预期结果：**
- 显示成功消息："If the email exists, a password reset link has been sent."
- 收到密码重置邮件
- 邮件包含重置链接

---

#### TC-AUTH-011: 不存在的邮箱找回密码
**步骤：**
1. 访问 `/forgot-password` 页面
2. 输入不存在的邮箱地址
3. 点击"发送重置链接"按钮

**预期结果：**
- 显示成功消息（防止邮件枚举）
- 不发送邮件
- 不暴露邮箱是否存在的信息

---

#### TC-AUTH-012: 找回密码邮件内容验证
**步骤：**
1. 完成 TC-AUTH-010
2. 打开收到的密码重置邮件
3. 检查邮件内容

**预期结果：**
- 邮件主题："重置您的密码 - Travis Blog"
- 包含重置密码按钮
- 包含重置链接（如果按钮无法点击）
- 包含安全提示（24 小时过期）

---

### 5. 密码重置功能

#### TC-AUTH-013: 正常密码重置流程
**步骤：**
1. 完成 TC-AUTH-010，获取重置链接
2. 点击邮件中的重置链接
3. 访问 `/reset-password?token=xxx` 页面
4. 输入新密码
5. 输入确认密码（与新密码一致）
6. 点击"重置密码"按钮

**预期结果：**
- 密码重置成功
- 显示成功消息
- 自动跳转到登录页面
- 可以使用新密码登录

---

#### TC-AUTH-014: 过期 Token 重置密码
**步骤：**
1. 使用已过期的重置 token 访问 `/reset-password?token=expired_token`
2. 尝试重置密码

**预期结果：**
- 显示错误提示："重置链接已过期，请重新申请"
- 重置失败
- 需要重新申请密码重置

---

#### TC-AUTH-015: 无效 Token 重置密码
**步骤：**
1. 使用无效的 token 访问 `/reset-password?token=invalid_token`
2. 尝试重置密码

**预期结果：**
- 显示错误提示："重置链接无效"
- 重置失败

---

#### TC-AUTH-016: 密码确认校验（重置页面）
**步骤：**
1. 使用有效的重置 token 访问重置页面
2. 输入新密码：`newpassword123`
3. 输入确认密码：`newpassword456`（不一致）
4. 点击"重置密码"按钮

**预期结果：**
- 显示错误提示："两次输入的密码不一致"
- 重置失败

---

#### TC-AUTH-017: Token 一次性使用
**步骤：**
1. 完成 TC-AUTH-013（成功重置密码）
2. 再次使用相同的 token 访问重置页面

**预期结果：**
- 显示错误提示："重置链接已使用或无效"
- 重置失败
- Token 已被清除

---

## 📊 测试环境

### 测试环境配置
- **开发环境：** `http://localhost:3000`
- **生产环境：** `https://travis-blog.vercel.app`

### 测试数据准备
- 至少 2 个测试用户账号（邮箱/密码）
- 至少 1 个 Google 账号用于 OAuth 测试
- 测试邮箱用于接收密码重置邮件

---

## 🔍 测试重点

### 功能完整性
- ✅ 所有功能流程完整
- ✅ 错误处理正确
- ✅ 用户体验良好

### 安全性
- ✅ 密码加密存储
- ✅ Token 有效期限制
- ✅ 防止邮件枚举攻击
- ✅ 防止暴力破解

### 用户体验
- ✅ 错误提示清晰（中文）
- ✅ 加载状态显示
- ✅ 表单验证实时反馈

---

## 📝 测试执行记录

### 测试日期：_________

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| TC-AUTH-001 | ⬜ | |
| TC-AUTH-002 | ⬜ | |
| TC-AUTH-003 | ⬜ | |
| TC-AUTH-004 | ⬜ | |
| TC-AUTH-005 | ⬜ | |
| TC-AUTH-006 | ⬜ | |
| TC-AUTH-007 | ⬜ | |
| TC-AUTH-008 | ⬜ | |
| TC-AUTH-009 | ⬜ | |
| TC-AUTH-010 | ⬜ | |
| TC-AUTH-011 | ⬜ | |
| TC-AUTH-012 | ⬜ | |
| TC-AUTH-013 | ⬜ | |
| TC-AUTH-014 | ⬜ | |
| TC-AUTH-015 | ⬜ | |
| TC-AUTH-016 | ⬜ | |
| TC-AUTH-017 | ⬜ | |

---

## 🐛 问题跟踪

### 发现的问题
（在此记录测试过程中发现的问题）

---

## ✅ 测试总结

### 通过率：___ / 17

### 主要发现
- 

---

**测试执行人：** ________  
**测试完成日期：** ________

